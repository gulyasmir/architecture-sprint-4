# Задание 1. Анализ, идентификация проблем и решений, планирование

## Список проблемных мест в системе "Александрит"

### Технические проблемы

#### Высокая загрузка на MES:

1. Время расчёта стоимости заказа варьируется от 2-3 минут до 30 минут для сложных моделей. Расчёт цены выполняется в MES. Если MES работает медленно или недоступен, это блокирует процесс перехода заказа из статуса SUBMITTED в PRICE_CALCULATED.
2. Операторы жалуются на медленную загрузку первой страницы MES.
3. Интеграция через RabbitMQ вызывает задержки при обработке заказов.

#### Взаимодействие между системами:

1. Синхронизация статусов между системами. Изменение статусов заказа происходит в разных системах (онлайн-магазин, CRM, MES). Это требует надежной синхронизации данных через очередь сообщений (RabbitMQ). Потеря или задержка сообщений может привести к несоответствию статусов между системами. Заказ может застрять в промежуточном статусе или его обработка
2. Обработка ошибок при взаимодействии систем. Отсутствие механизма автоматического повторного выполнения в случае сбоев в интеграции между системами. Возможны необработанные заказы или несогласованные статусы.
3. Дублирование логики в CRM и MES. CRM и MES выполняют разные задачи, но оба имеют доступ к информации о заказах. Это может привести к дублированию логики обработки.
   Это ведет к усложнению поддержки кода и потенциальные баги.
4. Отсутствие единого источника правды

Каждая система (онлайн-магазин, CRM, MES) хранит свой набор данных. Если данные между системами расходятся, это сложно заметить и исправить. Риск неправильных данные о заказах в разных системах.

#### Слабая масштабируемость инфраструктуры:

1. Каждое приложение и база данных имеют только по одному инстансу.
2. Отсутствие горизонтального масштабирования приводит к снижению производительности при росте нагрузки.
3. MES отвечает за распределение заказов между операторами и расчёт цен. Это может быть узким местом при увеличении числа заказов, что даст задержки в работе операторов и общей обработке заказов.

#### Неэффективная работа с очередями RabbitMQ:

1. Очереди сообщений становятся узким местом при взаимодействии между MES и CRM. RabbitMQ может стать узким местом, если система будет обрабатывать большое количество заказов одновременно. Риск: Задержки в передаче сообщений, что повлияет на работу всех приложений.
2. Очерёдность обработки сообщений в RabbitMQ. Если сообщения об изменении статуса приходят в неправильной последовательности или задерживаются, то статусы в CRM, MES или онлайн-магазине могут оказаться неконсистентными. Риск: Неверное состояние заказа или зависание процесса.
3. Нет механизмов ретрайлов и обработки сообщений в случае их потери.

#### Долгий цикл релизов:

1. Процесс ручного тестирования E2E-сценариев занимает много времени.
2. Задержки в релизах растут из-за багов уровня high и highest.
3. На схеме нет явного упоминания централизованного мониторинга и логирования. Это ведет к усложнению диагностики и устранения сбоев.

#### Взаимодействие с 3D-файлами

3D-файлы хранятся отдельно в S3-совместимом хранилище. Если доступ к хранилищу временно нарушится, это заблокирует обработку заказов. Риски: Невозможность рассчитать стоимость заказа в MES или работать с файлами в онлайн-магазине.

#### Мануальное закрытие заказа (CRM)

Закрытие заказа в CRM может происходить вручную. Это увеличивает вероятность человеческих ошибок. Возможны некорректные статусы и потенциальные проблемы с клиентами.

#### Отсутствие SLA для внешних зависимостей

S3-хранилище, RabbitMQ и базы данных могут стать недоступны. Нет указания на резервные механизмы или SLA. Риск полной остановки системы при сбоях инфраструктуры.

### Бизнес-проблемы

#### Жалобы клиентов на задержки в выполнении заказов:

1. Клиенты B2C и партнёры через API сообщают о просроченных заказах.
2. Потеря крупных контрактов из-за проблем с заказами.

#### Неудобный интерфейс для операторов:

1. Операторы испытывают трудности при работе с дашбордом в MES.
2. Фильтры и пагинация не решают проблему долгой загрузки.

#Предлагаемые инициативы по улучшению

### 1. Масштабирование инфраструктуры

- Внедрить горизонтальное масштабирование для приложений и баз данных.
- Настроить автошардинг баз данных для распределения нагрузки.

### 2.Оптимизация работы MES

- Переработать алгоритмы расчёта стоимости заказов.
- Выделить отдельные очереди RabbitMQ для API-заказов и внутренних заказов.

### 3.Оптимизация очередей RabbitMQ

- Настроить механизм ретрайлов и DLQ (Dead Letter Queue).
- Добавить метрики и алертинг для мониторинга состояния очередей.

### 4.Автоматизация тестирования

- Внедрить автоматизированное тестирование E2E-сценариев.
- Разработать CI/CD-пайплайны с автоматической проверкой.

### 5.Улучшение интерфейса для операторов

- Оптимизировать дашборд в MES.
- Сортировать заказы по дате создания и отображать только актуальные.

## Приоритет инициатив

1. Масштабирование инфраструктуры
2. Оптимизация работы MES
3. Автоматизация тестирования
4. Настройка SLA и резервных механизмов для внешних зависимостей
5. Оптимизация очередей RabbitMQ
6. Улучшение интерфейса для операторов
7. Настройка взаимодействия с 3D-файлами
8. Автоматизация закрытия заказов в CRM

## Целевая архитектура через полгода

Через шесть месяцев система должна иметь горизонтально масштабируемую архитектуру с автошардингом баз данных и выделенными ресурсами для обработки заказов API. MES будет оптимизирован для быстрого расчёта стоимости заказов, а интерфейс операторов станет более удобным и отзывчивым.

## Три приоритетные инициативы на ближайшие полгода

### 1.Масштабирование инфраструктуры

Это устранит проблемы с производительностью и обеспечит готовность к росту нагрузки.

### 2.Оптимизация работы MES

Снижение времени расчёта стоимости и улучшение интерфейса оператора повысит удовлетворённость пользователей.

### 3.Автоматизация тестирования

Сокращение времени на тестирование и релизы позволит быстрее устранять баги и доставлять новые версии на продакшн.
